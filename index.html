<!DOCTYPE html>

<html>
  <head>
    <title>Bitcoin Bay Bartender</title>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu">
  </head>

  <script>
    const ws = new WebSocket("ws://localhost:3030/bartender"); // Replace with your WebSocket server URL

    ws.addEventListener("open", () => {
      ws.send("heyhowareya");
    });

    ws.addEventListener("message", (event) => {
      
      const message = event.data;
          
      if (message === "hey-bartender-pour-me-a-beer") {
        console.log("Pour beer!")
        pouringBeer();
      } else if (message.startsWith("ln")) {
        console.log("New bar tab!", message);
        showQRCode(message);
      }
    });

    ws.addEventListener("close", () => {
      console.log("Connection closed");
    });
    
    function pouringBeer() {
      console.log("Pouring beer.");
      pourBeer.style.display = "block";
      barTab.style.display = "none";
    }

    function showQRCode(data) {
      pourBeer.style.display = "none";
      barTab.style.display = "block";
      // For testing
      // pr.innerHTML = data;
      generateQRCode(data);
    }

    function generateQRCode(data) {
      let code = document.getElementById("payReq");
      code.innerHTML = "";
      let qr = new QRCode(document.getElementById("payReq"), data);
    }

  </script>
  <style>
    .container {
      display: flex;
      width: 100%;
      justify-content: space-around;
      align-items: center;
      height: 100vh;
      font-family: "Ubuntu";
    }

    .payReq {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .pourBeer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .bartender {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

  </style>
  <body>
    <div class="container">
      <div class="bartender">
        <h1>Bitcoin Bay Bartender</h1>
        <img src="./logo.png" width="250" height="250" />
      </div>
      <div id="pourBeer" class="pourBeer" style="display: none;">
        <h1 style="text-align: center;">Beer tab paid!</h1>
        <img src="./success.png" width="250" height="250" />
      </div>

      <div id="barTab" class="payReq" style="display: none;">
        <h1 style="text-align: center;">Pay Bar Tab</h1>
        <a id="payReq"></a>
        <p id="pr"></p>
      </div>
    </div>
  </body>
</html>

